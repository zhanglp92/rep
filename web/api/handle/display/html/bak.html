<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Title</title>
    <link href="/rep/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/rep/lib/bootstrap-table/dist/bootstrap-table.css" rel="stylesheet" />
    <link href="/rep/lib/x-editable/dist/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet" />
    <link href="/rep/lib/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.css" rel="stylesheet">

    <script src="/rep/lib/node_modules/popper.js/dist/umd/popper.js"></script>
    <script src="/rep/lib/js/jquery-3.3.1.min.js"></script>
    <script src="/rep/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="/rep/lib/bootstrap-table/dist/bootstrap-table.js"></script>
    <script src="/rep/lib/bootstrap-paginator/src/bootstrap-paginator.js"></script>
    <script src="/rep/lib/bootstrap-table/dist/locale/bootstrap-table-zh-CN.js"></script>
    <script src="/rep/lib/x-editable/dist/bootstrap3-editable/js/bootstrap-editable.js"></script>
    <!-- <script src="/rep/lib/bootstrap-switch/src/js/bootstrap-switch.js"></script> -->
    <!-- <script src="https://cdn.staticfile.org/angular.js/1.4.6/angular.min.js"></script> -->
</head>

<style>
    .table-hover,
    #mytab {
        width: 100%;
    }

    .like {
        margin-right: 10px;
    }
</style>

<!-- <form action="/RequestDemo/RequestDemo3" method="post">
    用户名：<input type="text" name="userName"><br/>
    密码：<input type="text" name="pwd"><br/>
    性别：<input type="radio" name="sex" value="男" checked="checked">男
        <input type="radio" name="sex" value="女">女<br/>
    爱好：<input type="checkbox" name="hobby" value="足球">足球
        <input type="checkbox" name="hobby" value="篮球">篮球
        <input type="checkbox" name="hobby" value="排球">排球
        <input type="checkbox" name="hobby" value="羽毛球">羽毛球<br/>
    所在城市：<select name="city">
             <option>---请选择---</option>
             <option value="bj">北京</option>
             <option value="sh">上海</option>
             <option value="sy">沈阳</option>
           </select>        
           <br/>
    <input type="submit" value="点击注册">
</form> -->


<div class="modal fade" id="addform" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">新增订单</h5>
            </div>
            <div class="modal-body">
                <form id="form-addform">
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">客户：</label>
                        <input type="text" class="form-control" name="f-userid">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">料型：</label>
                        <input type="text" class="form-control" name="f-type">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">颜色：</label>
                        <input type="text" class="form-control" name="f-colour">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">开向：</label>
                        <input type="text" class="form-control" name="f-opendirection">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">下单尺寸：</label>
                        <input type="text" class="form-control" name="f-size">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">花型：</label>
                        <input type="text" class="form-control" name="f-shape">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">玻璃：</label>
                        <input type="text" class="form-control" name="f-glass">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">平方米：</label>
                        <input type="text" class="form-control" name="f-squaremeter">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">单价：</label>
                        <input type="text" class="form-control" name="f-priceunit">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">单价/套：</label>
                        <input type="text" class="form-control" name="f-priceset">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">合计：</label>
                        <input type="text" class="form-control" name="f-price">
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="form-control-label">备注：</label>
                        <textarea class="form-control" id="f-remark" name="remark"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="addForm()">保存</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="adduser" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">新增用户</h5>
            </div>
            <div class="modal-body">
                <form id="form-adduser" url="/rep/api/v1/op" method="POST">
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">姓名：</label>
                        <input type="text" class="form-control" name="u-name">
                    </div>
                    <!-- <div class="form-group">
                            <label for="recipient-name" class="form-control-label">性别：</label>
                            男：<input type="radio" checked="checked" id="sex" name="sex" value="男" />
                            女：<input type="radio" id="sex" name="sex" value="男" />
                        </div> -->
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">电话：</label>
                        <input type="text" class="form-control" name="u-phone">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="form-control-label">地址：</label>
                        <input type="text" class="form-control" name="u-addr">
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="form-control-label">备注：</label>
                        <textarea class="form-control" name="u-remark"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="addUser()">保存</button>
            </div>
        </div>
    </div>
</div>


<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addform"
    data-whatever="@mdo">新增订单</button>
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#adduser"
    data-whatever="@mdo">新增客户</button>
<table id="mytab" class="table-hover"></table>


<script>

    function addUser() {
        var form_adduser = document.getElementById('form-adduser')

        // var newElement = document.createElement("input")
        // newElement.setAttribute("type", "hidden")
        // newElement.name = "type"
        // newElement.value = "user"
        // form_adduser.appendChild(newElement)

        alert("ADD user")

        form_adduser.submit()

        // row = {
        //     "name": document.getElementById('u-name').value,
        //     "phone": document.getElementById('u-phone').value,
        //     "addr": document.getElementById('u-addr').value,
        //     // "sex": document.getElementById('u-sex').value,
        //     "remark": document.getElementById('u-remark').value,
        // }

        // $.post(
        //     "/rep/api/v1/op",
        //     { "type": "user", "op": "put", "obj": JSON.stringify(row) },
        //     function (data, status) {
        //         if (status === "success" && data == "null") {
        //             alert("添加成功")
        //         } else {
        //             alert(JSON.stringify(data))
        //         }
        //     }
        // )
    }

    var form_addform = document.getElementById('form-addform');
    function addForm() {
        row = {
            "userid": document.getElementById("f-userid").value,
            "type": document.getElementById("f-type").value,
            "colour": document.getElementById("f-colour").value,
            "opendirection": document.getElementById("f-opendirection").value,
            "size": document.getElementById("f-size").value,
            "shape": document.getElementById("f-shape").value,
            "glass": document.getElementById("f-glass").value,
            "squaremeter": document.getElementById("f-squaremeter").value,
            "priceunit": document.getElementById("f-priceunit").value,
            "priceset": document.getElementById("f-priceset").value,
            "price": document.getElementById("f-price").value,
            "remark": document.getElementById("f-remark").value,
        }
        alert(JSON.stringify(row))

        $.post(
            "/rep/api/v1/op",
            { "type": "form", "op": "put", "obj": JSON.stringify(row) },
            function (data, status) {
                if (status === "success" && data == "null") {
                    alert("添加成功")
                } else {
                    alert(JSON.stringify(data))
                }
            }
        )
    }


    $('#mytab').bootstrapTable({
        url: '/rep/api/v1/op?type=form&op=range',

        uniqueId: "ID",
        striped: true,      //是否显示行间隔色
        cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: true,     //是否显示分页（*）
        sortable: true,      //是否启用排序
        sortOrder: "ID asc",     //排序方式
        pageNumber: 1,      //初始化加载第一页，默认第一页
        pageSize: 12,      //每页的记录行数（*）
        pageList: [20, 50, 100, 150],  //可供选择的每页的行数（*）
        queryParamsType: '', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
        //queryParams: queryParams,//前端调用服务时，会默认传递上边提到的参数，如果需要添加自定义参数，可以自定义一个函数返回请求参数
        showColumns: true, //是否显示所有的列
        // showRefresh: true, //是否显示刷新按钮
        minimumCountColumns: 2,    //最少允许的列数
        // clickToSelect: true,    //是否启用点击选中行
        search: true, //是否显示表格搜索
        // strictSearch: true, // 严格搜索
        showExport: true,
        // clickEdit: true,
        showPaginationSwitch: true,

        // searchAlign: "left",//查询框对齐方式
        // buttonsAlign: "left",//按钮对齐方式
        searchOnEnterKey: true,//回车搜索
        toolbar: "#toolbar",//指定工具栏
        toolbarAlign: "right",//工具栏对齐方式,


        onClickCell: function (field, value, row, $element) {
            if (constField[field]) {
                return
            }

            $element.attr('contenteditable', true);
            $element.blur(function () {
                let newValue = $element.html();
                if (value == newValue) {
                    return
                }
                modifyForm(field, newValue, row)
            });
        },

        columns: [
            {
                checkbox: true
            },
            {
                title: 'ID',
                field: 'id',
                align: "center",
                valign: "middle",
            },
            {
                title: '客户',
                field: 'user',
                align: "center",
                valign: "middle",
                sortable: true,
                formatter: getName,
            },
            {
                title: '电话',
                field: 'user',
                align: "center",
                valign: "middle",
                formatter: getPhone,
                // visible 会影响可编译按钮位置
                // visible: false,
            },
            {
                field: 'type',
                title: '料型',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'colour',
                title: '颜色',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'opendirection',
                title: '开向',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'size',
                title: '下单尺寸',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'shape',
                title: '花型',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'glass',
                title: '玻璃',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'squaremeter',
                title: '平方米',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'priceunit',
                title: '单价',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'priceset',
                title: '单价/套',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'price',
                title: '合计',
                align: "center",
                valign: "middle",
                sortable: true,
            },
            {
                field: 'remarks',
                title: '客户特殊要求备注',
            },
            {
                field: 'op', title: '操作', align: 'center', valign: 'middle',
                formatter: operation,
            }
        ]
    });

    function operation(value, row, index) {
        del = '<a href="#" class="btn btn-info" onclick="del(' + row["id"] + ')">删除</a>'
        return del
    }

    function getName(value, row, index) {
        return '<a onclick="getUserInfo(' + value["id"] + ')">' + value["name"] + '</a>';
    }

    function getPhone(value, row, index) {
        return value["phone"]
    }

    function del(id) {
        url = "/rep/api/v1/op?type=form&op=del&id=" + id

        $.ajax({
            url: url,
            success: function (data, status) {
                if (status !== "success") {
                    alert(data)
                } else {
                    alert("删除成功")
                }
            },
            error: function (data) {
                alert(data)
            }
        })
    }

    function getUserInfo(id) {
        url = "/rep/api/v1/op?type=user&op=get&id=" + id

        $.ajax({
            url: url,
            success: function (data) {
                alert(data)
            },
            error: function (data) {
                alert(data)
            }
        })
    }

    var constField = {
        "user": true, "id": true
    }

    var fieldTy = {
        "id": "int",
        "userid": "int",
        "type": "string",
        "colour": "string",
        "opendirection": "string",
        "size": "string",
        "shape": "string",
        "squaremeter": "float",
        "priceunit": "float",
        "priceset": "float",
        "price": "float",
        "remarks": "string",
    }

    function toType(field, value) {
        switch (fieldTy[field]) {
            case "int":
                return parseInt(value)
            case "string":
                return value
            case "float":
                return parseFloat(value)
        }
        return value
    }

    function modifyForm(field, newValue, row) {
        row[field] = toType(field, newValue)

        $.post(
            "/rep/api/v1/op",
            { "type": "form", "op": "put", "obj": JSON.stringify(row) },
            function (data, status) {
                if (status != "success") {
                    alert("添加失败:" + JSON.stringify(data))
                }
            }
        )
    }

    function addform() {
        alert("addform")
    }

</script>
</body>

</html>